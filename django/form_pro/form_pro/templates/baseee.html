{% load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css", integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.css">
    <script src="/static/jsfiles/main.js" type="text/javascript"></script> -->
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.css" integrity="sha256-jKV9n9bkk/CTP8zbtEtnKaKf+ehRovOYeKoyfthwbC8=" crossorigin="anonymous" />
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col mt-4">
                <div id="image-box" class="mt-4">
                    kkkkk
                    <!-- <img src={{obj.file.url }} id="image" width="400px"> -->
                </div>
                <form action="" id="image-form" class="mt-4">
                    {% csrf_token %}
                    {{form}}
                </form>
                <button class="c btn btn-success mt-3 d-none" id="confirm-btn ">Confirm</button>
            </div>      
         </div>
    </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.js" integrity="sha256-CgvH7sz3tHhkiVKh05kSUgG97YtzYNnWt6OXcmYzqHY=" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.0/cropper.min.css" rel="stylesheet"/>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/0.8.0/cropper.min.js"></script>
    <script>

const csrf=document.getElementsByName('csrfmiddlewaretoken')
const imageBox=document.getElementById('image-box')
const imageForm=document.getElementById('image-form')
const confirmBtn=document.getElementsByClassName('c')[0]
console.log(imageForm,'form')
const input=document.getElementById('id_file')
var image = document.getElementById('image')
// const csrf=document.getElementsByName('csrfmiddlewaretoken')
console.log(input)





    $(document).ready(function(){
            $(document).find('input').change((e)=>{
                $(document).find('.c').removeClass('d-none')
                img_data=e.target.files[0]
                img_url=URL.createObjectURL(img_data)
                console.log(img_data,'iiii')
                imageBox.innerHTML=`<img src="${img_url}" id="image" width="400px">`
                
                // var image=$('#image');

                // image.cropper({
                //     aspectRatio: 9 / 9,
                //     crop: function(event) {
                //         console.log(event.detail.x);
                //         console.log(event.detail.y);
                //         console.log(event.detail.width);
                //         console.log(event.detail.height);
                //         console.log(event.detail.rotate);
                //         console.log(event.detail.scaleX);
                //         console.log(event.detail.scaleY);
                // }
                // });
                var cropper = $image.data('cropper');
                var cropper = $image.data('cropper');
                var image = document.getElementById('image');
                var cropper = new Cropper(image, {
                aspectRatio: 16 / 9,
                crop: function(e) {
                    console.log(e.detail.x);
                    console.log(e.detail.y);
                    }
                });
             
             });
           
          
            confirmBtn.addEventListener('click',()=>{
                alert("x")
                var cropper = image.data('cropper')
                cropper.getCroppedCanvas().toBlob((blob)=>{
                    const fd= new FormData()
                    fd.append('file',blob,'my-image.png')
                    $.ajax({
                        type:"POST",
                        url:"{% url 'pic' %}",
                        enctype:"multipart/form-data",
                        data:fd,
                        success:function(response){
                            console.log(response)
                        },
                        error:function(error){
                            console.log(error)
                        },
                        cache:false,
                        contentType:false,
                        processData:false,
                    })
                })
            
            })
        

        })
   


    </script>
</body>
</html>